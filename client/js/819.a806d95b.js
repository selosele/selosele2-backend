"use strict";(self["webpackChunkselosele2"]=self["webpackChunkselosele2"]||[]).push([[819],{2819:function(e,t,a){a.r(t),a.d(t,{default:function(){return g}});var r=a(3396);function o(e,t,a,o,s,i){const n=(0,r.up)("ui-button"),l=(0,r.up)("ui-tree"),c=(0,r.up)("ui-pane"),d=(0,r.up)("app-save-category"),u=(0,r.up)("ui-split-pane"),h=(0,r.up)("ui-tab"),g=(0,r.up)("ui-tabs"),y=(0,r.up)("app-content-wrapper");return(0,r.wg)(),(0,r.j4)(y,null,{default:(0,r.w5)((()=>[(0,r.Wm)(g,{onTabChanged:i.onTabChanged},{default:(0,r.w5)((()=>[(0,r.Wm)(h,{name:"카테고리"},{default:(0,r.w5)((()=>[(0,r.Wm)(u,null,{default:(0,r.w5)((()=>[(0,r.Wm)(c,{isTransparent:!0},{default:(0,r.w5)((()=>[(0,r.Wm)(l,{nodes:s.categoryTree,useCheckbox:!1,filter:!0,placeholder:"카테고리/포스트 제목 입력",onNodeClick:i.onNodeClick},{btn:(0,r.w5)((()=>[(0,r.Wm)(n,{color:"primary",text:"추가",onClick:i.addCategory},null,8,["onClick"])])),_:1},8,["nodes","onNodeClick"])])),_:1}),e.isSplitterActive?((0,r.wg)(),(0,r.j4)(c,{key:0},{default:(0,r.w5)((()=>[((0,r.wg)(),(0,r.j4)(d,{category:s.category,type:"D01004",key:s.type+s.category.id,onRefreshCategory:i.refreshTree},null,8,["category","onRefreshCategory"]))])),_:1})):(0,r.kq)("",!0)])),_:1})])),_:1}),(0,r.Wm)(h,{name:"태그"},{default:(0,r.w5)((()=>[(0,r.Wm)(u,null,{default:(0,r.w5)((()=>[(0,r.Wm)(c,{isTransparent:!0},{default:(0,r.w5)((()=>[(0,r.Wm)(l,{nodes:s.tagTree,useCheckbox:!1,filter:!0,placeholder:"태그/포스트 제목 입력",onNodeClick:i.onNodeClick},{btn:(0,r.w5)((()=>[(0,r.Wm)(n,{color:"primary",text:"추가",onClick:i.addCategory},null,8,["onClick"])])),_:1},8,["nodes","onNodeClick"])])),_:1}),e.isSplitterActive?((0,r.wg)(),(0,r.j4)(c,{key:0},{default:(0,r.w5)((()=>[((0,r.wg)(),(0,r.j4)(d,{category:s.category,type:"D01005",key:s.type+s.category.id,onRefreshCategory:i.refreshTree},null,8,["category","onRefreshCategory"]))])),_:1})):(0,r.kq)("",!0)])),_:1})])),_:1})])),_:1},8,["onTabChanged"])])),_:1})}function s(e,t,a,o,s,i){const n=(0,r.up)("ui-hidden-field"),l=(0,r.up)("ui-text-field"),c=(0,r.up)("ui-split-form");return(0,r.wg)(),(0,r.j4)(c,{name:"saveCategoryForm",btnRemove:!0,onOnsubmit:i.onSubmit,onRemove:i.onRemove},{default:(0,r.w5)((()=>[(0,r.Wm)(n,{name:"id",value:a.category.id},null,8,["value"]),(0,r.Wm)(n,{name:"type",value:a.type},null,8,["value"]),(0,r.Wm)(l,{name:"nm",id:"categoryNm",label:`${s.text} 명`,rules:"required|max:50",block:!0,value:a.category.nm},null,8,["label","value"]),(0,r.Wm)(l,{name:"desc",id:"categoryDesc",label:`${s.text} 설명`,rules:"max:100",block:!0,value:a.category.desc},null,8,["label","value"]),(0,r.Wm)(l,{name:"regDate",id:"categoryRegDate",label:`${s.text} 등록일시`,readonly:!0,block:!0,value:a.category.regDate},null,8,["label","value"])])),_:1},8,["onOnsubmit","onRemove"])}var i=a(8822),n={name:"AppSaveCategory",props:{category:Object,type:String},data(){return{text:""}},created(){"D01004"===this.type?this.text="카테고리":"D01005"===this.type&&(this.text="태그")},methods:{async onSubmit(e){const t=await i.wW.confirmSuccess("저장하시겠습니까?");t&&((0,i.xb)(e.id)?await this.addCategory(e):await this.updateCategory(e))},async onRemove(e){if((0,i.xb)(e.id))return;const t=await i.wW.confirmSuccess("삭제하시겠습니까?");t&&this.$http.delete(`${this.getApiUri(e)}/${e.id}`).then((e=>{i.wW.toastSuccess("삭제되었습니다."),this.$emit("refreshCategory")}))},addCategory(e){return this.$http.post(this.getApiUri(e),e).then((e=>{i.wW.toastSuccess("저장되었습니다."),this.$emit("refreshCategory")}))},updateCategory(e){return this.$http.put(this.getApiUri(e),e).then((e=>{i.wW.toastSuccess("저장되었습니다."),this.$emit("refreshCategory")}))},getApiUri(e){return"D01004"===e.type?"/category":"D01005"===e.type?"/tag":""}}},l=a(89);const c=(0,l.Z)(n,[["render",s]]);var d=c,u={name:"AppAdminCategory",components:{AppSaveCategory:d},data(){return{categoryTree:[],tagTree:[],category:{},type:"",activeIndex:-1}},created(){this.init()},methods:{async init(){this.$store.dispatch("Breadcrumb/FETCH_PAGE_TITLE","카테고리/태그 관리"),await Promise.all([this.listCategoryTreeAndPost(),this.listTagTreeAndPost()]),this.$store.commit("Splitter/TOGGLE",!0)},listCategoryTreeAndPost(){return this.$http.get("/category/list/tree").then((e=>{this.createTree(e.data,"D01004")}))},listTagTreeAndPost(){return this.$http.get("/tag/list/tree").then((e=>{this.createTree(e.data,"D01005")}))},createTree(e,t){e.forEach((e=>{let a=[];"D01004"===t?a=e.postCategory:"D01005"===t&&(a=e.postTag);let r={id:e.id,label:this.getTreeLabel(e.nm,t),nodes:a.map(((e,t,a)=>0===a.length?{}:{id:e.postId,label:e.post.title}))};this.pushNode(r,t)}))},async refreshTree(){this.resetCategory(),this.categoryTree=[],this.tagTree=[],this.$store.dispatch("Layout/FETCH_SIDEBAR",{}),this.$store.dispatch("Layout/FETCH_IS_SIDEBAR_LOADED",!1),await Promise.all([this.listCategoryTreeAndPost(),this.listTagTreeAndPost()])},getTreeLabel(e,t){return"D01004"===t?e:`#${e}`},pushNode(e,t){"D01004"===t?this.categoryTree.push(e):"D01005"===t&&this.tagTree.push(e)},async onNodeClick(e){this.$store.commit("Splitter/TOGGLE",!0),this.isPostNode(e.nodes)?this.$router.push(`/post/${e.id}`):this.isPostNode(e.nodes)||e.id===this.category?.id||await this.getCategory(e)},onTabChanged(e){this.resetCategory(),this.activeIndex=e.tab.index},getCategory(e){return 0===this.activeIndex&&(this.type="category"),1===this.activeIndex&&(this.type="tag"),this.$http.get(`/${this.type}/${e.id}`).then((e=>{this.category={...e.data},this.category.regDate=this.$moment(this.category.regDate).format("YYYY-MM-DD HH:mm:ss")}))},addCategory(){this.resetCategory()},resetCategory(){this.category={},this.category.id=null},isPostNode(e){return(0,i.xb)(e)}}};const h=(0,l.Z)(u,[["render",o]]);var g=h}}]);